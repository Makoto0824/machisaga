<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¾ã¡ã‚µãƒ¼ã‚¬ - ç®¡ç†è€…ãƒ‘ãƒãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 2rem;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .url-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .url-table th,
        .url-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .url-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            color: #ffd700;
        }
        
        .url-table td {
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .url-key {
            font-weight: bold;
            color: #4ade80;
        }
        
        .url-target {
            word-break: break-all;
            max-width: 300px;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
            font-size: 0.85rem;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .tools {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                margin: 1rem;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .url-table {
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ° ã¾ã¡ã‚µãƒ¼ã‚¬</div>
            <div class="subtitle">ç®¡ç†è€…ãƒ‘ãƒãƒ« - URLç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalUrls">-</div>
                <div class="stat-label">ç®¡ç†å¯¾è±¡URL</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeUrls">-</div>
                <div class="stat-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="tokenExpiry">-</div>
                <div class="stat-label">ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™</div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ”— URLç®¡ç†</h2>
            <p>ç¾åœ¨ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆURLã®ä¸€è¦§ã§ã™ã€‚</p>
            
            <table class="url-table">
                <thead>
                    <tr>
                        <th>ã‚­ãƒ¼</th>
                        <th>è¡¨ç¤ºå</th>
                        <th>å¯¾è±¡URL</th>
                        <th>ã‚¨ãƒ³ãƒˆãƒªãƒ¼URL</th>
                        <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                    </tr>
                </thead>
                <tbody id="urlTableBody">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>ğŸ› ï¸ ç®¡ç†ãƒ„ãƒ¼ãƒ«</h2>
            <p>ã‚·ã‚¹ãƒ†ãƒ ã®ç®¡ç†ã¨ãƒ†ã‚¹ãƒˆç”¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
            
            <div class="tools">
                <button class="btn" onclick="openTestPage()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</button>
                <button class="btn" onclick="openQRGenerator()">ğŸ“± QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
                <button class="btn secondary" onclick="exportUrls()">ğŸ“ URLä¸€è¦§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button class="btn secondary" onclick="testAllUrls()">âš¡ å…¨URLæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h2>
            <div style="font-family: monospace; font-size: 0.9rem; line-height: 1.6;">
                <p><strong>API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:</strong> <code>/api/generate-token</code></p>
                <p><strong>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒšãƒ¼ã‚¸:</strong> <code>/redirect/[token]</code></p>
                <p><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:</strong> HMAC-SHA256ç½²å</p>
                <p><strong>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ:</strong> <code id="defaultTarget">-</code></p>
                <p><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ:</strong> <code id="timeoutDuration">-</code>ç§’</p>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®šã‚’ç›´æ¥å®šç¾©ï¼ˆconfig.jsã¨åŒæœŸï¼‰
        const TARGET_URLS = {
            // ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆMSCå ±é…¬é †ï¼‰
            'event_1msc': 'https://play.ttt.games/worlds/machi-saga/events/b-mjFuRIEBL3xROr64xXA3qaSkZ5L926lSWCOXVtH60/checkin',
            'event_4msc': 'https://play.ttt.games/worlds/machi-saga/events/iZP-oFgwKs-rwFFVToqXkV488vnDHjyxIPF_hZ5y8MM/checkin',
            'event_6msc': 'https://play.ttt.games/worlds/machi-saga/events/x2pNQFx8ChWMoYPfgrXopstCgZ9HMF8JCPpNXmyXpn0/checkin',
            'event_8msc': 'https://play.ttt.games/worlds/machi-saga/events/Ti0h_WV3B8OiAXAi-vxtodyw6wAyT35MHRGcsCBuh0g/checkin',
            'event_10msc': 'https://play.ttt.games/worlds/machi-saga/events/17VlTOfDKjp6tqoAnuXxlgvsE4wRofg2Hz1i_rr_5Fc/checkin',
            'event_12msc': 'https://play.ttt.games/worlds/machi-saga/events/MyKXAlK_qOWpn9hKrZEWrQKypMoE8Ess9C1PhKBXg0A/checkin',
            'event_14msc': 'https://play.ttt.games/worlds/machi-saga/events/CrXfZStcu7XMtyDI77JE5lKlk7RYsZVcF5Xdk2XyiB0/checkin',
            'event_16msc': 'https://play.ttt.games/worlds/machi-saga/events/in7B9olSOc9H-W7yoxpV3T9WFJQwgM9vYUVrkKyHgBU/checkin',
            'event_21msc': 'https://play.ttt.games/worlds/machi-saga/events/WsDzeA-BjEOjN833J0-tTzRDHnnLLzFMytiCf5gseD4/checkin'
        };
        
        const TARGET_NAMES = {
            'event_1msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 1 MSCå ±é…¬',
            'event_4msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 4 MSCå ±é…¬',
            'event_6msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 6 MSCå ±é…¬',
            'event_8msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 8 MSCå ±é…¬',
            'event_10msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 10 MSCå ±é…¬',
            'event_12msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 12 MSCå ±é…¬',
            'event_14msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 14 MSCå ±é…¬',
            'event_16msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 16 MSCå ±é…¬',
            'event_21msc': 'ã¾ã¡ã‚µãƒ¼ã‚¬ã‚¤ãƒ™ãƒ³ãƒˆ - 21 MSCå ±é…¬'
        };
        
        const CONFIG = {
            defaultTarget: 'event_21msc',
            tokenExpiry: 5 * 60 * 1000, // 5åˆ†
            secretKey: 'machisaga-secret-key-2025',
            maxRedirectAttempts: 3,
            timeoutDuration: 10000 // 10ç§’
        };
        
        console.log('ç®¡ç†ãƒ‘ãƒãƒ«è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†:', {
            targetCount: Object.keys(TARGET_URLS).length,
            targets: Object.keys(TARGET_URLS)
        });
        
        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('totalUrls').textContent = Object.keys(TARGET_URLS).length;
            document.getElementById('activeUrls').textContent = Object.keys(TARGET_URLS).length;
            document.getElementById('tokenExpiry').textContent = CONFIG.tokenExpiry / 1000 / 60 + 'åˆ†';
            document.getElementById('defaultTarget').textContent = CONFIG.defaultTarget;
            document.getElementById('timeoutDuration').textContent = CONFIG.timeoutDuration / 1000;
        }
        
        // URLãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
        function generateUrlTable() {
            const tbody = document.getElementById('urlTableBody');
            if (!tbody) {
                console.error('URLãƒ†ãƒ¼ãƒ–ãƒ«ã®tbodyãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            tbody.innerHTML = '';
            
            // MSCé †ã§ã‚½ãƒ¼ãƒˆ
            const sortedKeys = Object.keys(TARGET_URLS).sort((a, b) => {
                const mscA = parseInt(a.match(/(\d+)msc/)[1]);
                const mscB = parseInt(b.match(/(\d+)msc/)[1]);
                return mscA - mscB;
            });
            
            sortedKeys.forEach(key => {
                const row = document.createElement('tr');
                const targetUrl = TARGET_URLS[key];
                const displayName = TARGET_NAMES[key] || key;
                const entryUrl = `${window.location.origin}/entry.html?target=${key}`;
                
                row.innerHTML = `
                    <td class="url-key">${key}</td>
                    <td>${displayName}</td>
                    <td class="url-target">${targetUrl}</td>
                    <td class="url-target">${entryUrl}</td>
                    <td class="action-buttons">
                        <button class="btn" onclick="testEntry('${key}')">ğŸ§ª ãƒ†ã‚¹ãƒˆ</button>
                        <button class="btn" onclick="generateQR('${key}')">ğŸ“± QR</button>
                        <button class="btn secondary" onclick="copyUrl('${entryUrl}')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log('URLãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆå®Œäº†:', sortedKeys.length + 'ä»¶');
        }
        
        // ç®¡ç†ãƒ„ãƒ¼ãƒ«é–¢æ•°
        function openTestPage() {
            window.open('/test', '_blank');
        }
        
        function openQRGenerator() {
            window.open('/qr-generator.html', '_blank');
        }
        
        function testEntry(key) {
            const entryUrl = `${window.location.origin}/entry.html?target=${key}`;
            window.open(entryUrl, '_blank');
        }
        
        function generateQR(key) {
            const qrUrl = `/qr-generator.html#${key}`;
            window.open(qrUrl, '_blank');
        }
        
        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(err => {
                console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:', err);
                prompt('ä¸‹è¨˜URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:', url);
            });
        }
        
        function exportUrls() {
            const data = {
                timestamp: new Date().toISOString(),
                urls: TARGET_URLS,
                names: TARGET_NAMES,
                config: CONFIG
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.download = `machisaga-urls-${new Date().toISOString().split('T')[0]}.json`;
            link.href = URL.createObjectURL(blob);
            link.click();
        }
        
        function testAllUrls() {
            console.log('å…¨URLæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            let results = [];
            
            Object.keys(TARGET_URLS).forEach(async (key, index) => {
                setTimeout(async () => {
                    const entryUrl = `${window.location.origin}/entry.html?target=${key}`;
                    try {
                        const response = await fetch(`/api/generate-token?url=${encodeURIComponent(TARGET_URLS[key])}`);
                        const result = await response.json();
                        
                        results.push({
                            key: key,
                            status: result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—',
                            url: TARGET_URLS[key]
                        });
                        
                        console.log(`${key}: ${result.success ? 'æˆåŠŸ' : 'å¤±æ•—'}`);
                        
                        // å…¨ã¦å®Œäº†ã—ãŸã‚‰çµæœè¡¨ç¤º
                        if (results.length === Object.keys(TARGET_URLS).length) {
                            const summary = results.map(r => `${r.key}: ${r.status}`).join('\n');
                            alert(`æ¥ç¶šãƒ†ã‚¹ãƒˆçµæœ:\n\n${summary}`);
                        }
                    } catch (error) {
                        console.error(`${key} ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:`, error);
                        results.push({
                            key: key,
                            status: 'âŒ ã‚¨ãƒ©ãƒ¼',
                            url: TARGET_URLS[key]
                        });
                    }
                }, index * 500); // 500msãšã¤é…å»¶
            });
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded - åˆæœŸåŒ–é–‹å§‹');
            console.log('TARGET_URLS:', TARGET_URLS);
            console.log('TARGET_NAMES:', TARGET_NAMES);
            console.log('CONFIG:', CONFIG);
            
            try {
                updateStats();
                console.log('çµ±è¨ˆæƒ…å ±æ›´æ–°å®Œäº†');
                
                generateUrlTable();
                console.log('URLãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆå®Œäº†');
                
                console.log('ç®¡ç†è€…ãƒ‘ãƒãƒ«åˆæœŸåŒ–å®Œäº†:', {
                    totalUrls: Object.keys(TARGET_URLS).length,
                    defaultTarget: CONFIG.defaultTarget,
                    tableBody: document.getElementById('urlTableBody')
                });
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                alert('ç®¡ç†è€…ãƒ‘ãƒãƒ«ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        });
    </script>
</body>
</html>
